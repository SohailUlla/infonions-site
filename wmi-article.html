<script>
function getQueryParam(name) {
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}

function simpleMarkdownToHTML(md) {
  return md
    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
    .replace(/^### (.*$)/gim, '<h3>$1</h3>')
    .replace(/^\> (.*$)/gim, '<blockquote>$1</blockquote>')
    .replace(/^\- (.*$)/gim, '<li>$1</li>')
    .replace(/\n{2,}/g, '</p><p>')
    .replace(/^(?!<h|<li|<blockquote)(.+)$/gim, '<p>$1</p>');
}

async function loadFullArticle() {
  let filePath = getQueryParam("file");
  const container = document.getElementById("articleContainer");

  if (!filePath) {
    container.innerHTML = "<p>Article not found.</p>";
    return;
  }

  if (!filePath.startsWith("/")) {
    filePath = "/" + filePath;
  }

  try {
    const res = await fetch(filePath);
    const text = await res.text();

    const title = (text.match(/title:\s*(.*)/) || [])[1] || "Article";
    const impact = (text.match(/impact:\s*(.*)/) || [])[1] || "Medium";
    const domain = (text.match(/domain:\s*(.*)/) || [])[1] || "General";

    // Extract article body after first ## heading
    const bodyStart = text.indexOf("##");
    let body = bodyStart !== -1 ? text.substring(bodyStart) : "";

    // Convert markdown to HTML
    const htmlBody = simpleMarkdownToHTML(body);

    container.innerHTML = `
      <article class="signal-card high">

        <div class="signal-meta">
          <span class="impact high">${impact.toUpperCase()} IMPACT</span>
          <span class="domain">${domain.toUpperCase()}</span>
        </div>

        <h1>${title}</h1>

        <div class="signal-summary">
          ${htmlBody}
        </div>

      </article>
    `;
  } catch (err) {
    container.innerHTML = "<p>Unable to load article.</p>";
  }
}

loadFullArticle();
</script>
